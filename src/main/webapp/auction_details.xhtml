<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="template_contentpage.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:metadata>
        <f:viewParam name="id" value="#{auctionDetailsBean.id}"/>
        <f:event type="preRenderView" listener="#{auctionDetailsBean.init}"/>
    </f:metadata>

    <ui:define name="pageTitle">PrzydaSie - Szczegóły Aukcji</ui:define>

    <ui:define name="content">
        <div class="container mt-4">
            <h:messages globalOnly="true" layout="table" styleClass="alert alert-info w-100" errorClass="alert alert-danger w-100" infoClass="alert alert-success w-100"/>

            <h:panelGroup rendered="#{auctionDetailsBean.auction != null}">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h2 class="h4 mb-0">#{auctionDetailsBean.auction.name}</h2>
                        <h:form rendered="#{auctionDetailsBean.isAuctionOwner()}">
                            <h:commandButton value="Usuń Aukcję" action="#{auctionDetailsBean.deleteAuction}"
                                             styleClass="btn btn-danger btn-sm"/>
                        </h:form>
                    </div>
                    <div class="card-body">
                        <p class="card-text"><strong>Opis:</strong> #{auctionDetailsBean.auction.description}</p>
                        <p><strong>Status:</strong> <span class="badge #{auctionDetailsBean.auction.status == 'ACTIVE' ? 'bg-success' : 'bg-secondary'}">#{auctionDetailsBean.auction.status}</span></p>
                        <p><strong>Data Rozpoczęcia:</strong>
                            <h:outputText value="#{auctionDetailsBean.auction.startTime}">
                                <f:convertDateTime type="localDateTime" pattern="dd MMMM yyyy, HH:mm" locale="pl_PL"/>
                            </h:outputText>
                        </p>
                        <p><strong>Data Zakończenia:</strong>
                            <h:outputText value="#{auctionDetailsBean.auction.endTime}">
                                <f:convertDateTime type="localDateTime" pattern="dd MMMM yyyy, HH:mm" locale="pl_PL"/>
                            </h:outputText>
                        </p>
                        <p><strong>Cena wywoławcza:</strong>
                            <h:outputText value="#{auctionDetailsBean.auction.startPrice}">
                                <f:convertNumber type="currency" currencySymbol="PLN" />
                            </h:outputText>
                        </p>
                    </div>
                </div>

                <h:panelGroup rendered="#{auctionDetailsBean.canPlaceBid()}" styleClass="mb-4">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h4 class="card-title">Złóż ofertę</h4>
                            <h:form>
                                <div class="input-group">
                                    <span class="input-group-text">PLN</span>
                                    <h:inputText id="bidAmount" value="#{auctionDetailsBean.bidAmount}" styleClass="form-control" required="true" requiredMessage="Kwota jest wymagana">
                                        <f:convertNumber type="number" groupingUsed="false" />
                                    </h:inputText>
                                    <h:commandButton value="Licytuj" action="#{auctionDetailsBean.placeBid}" styleClass="btn btn-primary"/>
                                </div>
                                <h:message for="bidAmount" styleClass="text-danger small mt-1"/>
                            </h:form>
                        </div>
                    </div>
                </h:panelGroup>

                <div class="card shadow-sm">
                    <div class="card-header bg-light">
                        <h3 class="h5 mb-0">Historia Ofert</h3>
                    </div>
                    <div class="card-body">
                        <h:panelGroup rendered="#{not empty auctionDetailsBean.getSortedBids()}">
                            <ul class="list-group list-group-flush">
                                <ui:repeat value="#{auctionDetailsBean.getSortedBids()}" var="bid">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span><h:outputText value="#{bid.bidder.name}"/></span>
                                        <span class="fw-bold">
                                             <h:outputText value="#{bid.bidAmount}">
                                                 <f:convertNumber type="currency" currencySymbol="PLN" />
                                             </h:outputText>
                                        </span>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{empty auctionDetailsBean.getSortedBids()}">
                            <p class="text-muted fst-italic">Brak ofert. Bądź pierwszy!</p>
                        </h:panelGroup>
                    </div>
                </div>
            </h:panelGroup>

            <h:panelGroup rendered="#{auctionDetailsBean.auction == null}">
                <div class="alert alert-warning text-center" role="alert">
                    Aukcja o podanym ID nie została znaleziona.
                </div>
            </h:panelGroup>
        </div>
    </ui:define>
</ui:composition>